<!DOCTYPE html>
<html>

<head>
<meta charset='utf-8' />
<script src='./dlist/index.global.js'></script>
<script>
	// async와 await를 사용해서, 코드 가독성을 높이자 !!!!!
	
	
  document.addEventListener('DOMContentLoaded', async function() {
	  
	  // aysnc라는 함수를 써야 그 아래에서 await 사용가능
	  
	  let cal = document.getElementById('calendar')
	  let eventList = [{		
		  title:"test",
		  start:"2023-01-04"
		}];
	  
	  let result = await fetch('eventList.do')	
	  let data = await result.json();
	  eventList = data;
	 

	var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {	//object type의 객체
    	// key : value
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      initialDate: new Date(), //'2025-01-12'
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectMirror: true,
      select: async function(arg) {	
      console.log(arg);	
        var title = prompt('일정을 등록하세요');
        
        if (title) {
        	let resolve = await fetch('addEvent.do?title=' + title + '&start=' + arg.startStr + '&end=' + arg.endStr)
        	let result = await resolve.json();
        	if (result.retCode == 'OK') {
        		calendar.addEvent({	 
                	title: title,
                	start: arg.start,
                	end: arg.end,
                	allDay: arg.allDay
            	  })	
        	}else if ( result.etCode == 'NG') {
        		aleret ('실패발생 !!!')
        	    }
             }// end of if
        calendar.unselect();
      },
      eventClick: async function (arg) {
        if (confirm('일정을 삭제하시겠습니까?')) {	// if문 실행문구가 한 줄 인경우 중첩if문 중괄로 생략가능
        	let resolve = await fetch('removeEvent.do?title=' + arg.event.title);
        	let result = await resolve.json();
        	
        		  if(result.retCode == 'OK') 
          			arg.event.remove()
        		  else if (result.retCode == 'NG') 
          		 	alert ('삭제실패')
        		  else
          			alert ('알 수 없는 에러코드') 
        	  }  // end of if
        },
      editable: true,
      dayMaxEvents: true, // allow "more" link when too many events
      events: eventList
      
    });
    calendar.render();	
	  
 });	// end of DOMContentLoaded
</script>
<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

</style>
</head>
<body>

  <div id='calendar'></div>

</body>
</html>
